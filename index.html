<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>無料鑑定フォーム</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:"Noto Sans JP",Arial,sans-serif;background:#fafafa;padding:20px;max-width:600px;margin:auto}
    h2{font-size:22px;font-weight:600;margin-bottom:20px}
    .form-group{margin-bottom:28px}
    label{font-weight:600;font-size:16px;display:block;margin-bottom:6px}
    .required{color:#e53935;margin-left:4px;font-size:14px}
    small{display:block;color:#666;font-size:13px;margin-top:4px}
    select,input[type=text],textarea{width:100%;padding:10px;font-size:15px;border:1px solid #ddd;border-radius:6px;background:#fff;box-sizing:border-box}
    .date-selects{display:flex;gap:8px}
    .date-selects select{flex:1}
    textarea{resize:vertical}
    button{width:100%;background:#06c755;border:0;border-radius:8px;color:#fff;font-size:18px;font-weight:600;padding:14px;cursor:pointer}
    .status{margin-top:12px;font-size:14px;color:#333;min-height:20px}
  </style>
</head>
<body>
  <h2>無料鑑定フォーム</h2>

  <form id="form">
    <div class="form-group">
      <label>お名前 <span class="required">*</span></label>
      <input type="text" name="name" required />
    </div>

    <div class="form-group">
      <label>生年月日をご記入ください。 <span class="required">*</span></label>
      <div class="date-selects">
        <select name="year" id="year" required>
          <option value="">西暦</option>
        </select>
        <select name="month" id="month" required>
          <option value="">月</option>
        </select>
        <select name="day" id="day" required>
          <option value="">日</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>現在のお悩みをご記入ください。 <span class="required">*</span></label>
      <textarea name="trouble" rows="4" required></textarea>
      <small>できるだけ詳しく書いていただいた方が、鑑定の精度が上がります。</small>
    </div>

    <div class="form-group">
      <label>理想の未来をご記入ください。 <span class="required">*</span></label>
      <textarea name="future" rows="4" required></textarea>
      <small>できるだけ詳しく書いていただいた方が、鑑定の精度が上がります。</small>
    </div>

    <input type="hidden" name="lineId" id="lineId" />
    <button id="submitBtn" type="submit">回答する</button>
    <div id="status" class="status"></div>
  </form>

  <script>
    const LIFF_ID = "2008039326-A8qpaB1Q";      // ←差し替え
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxfBfoCvfuf3D5jQjwTIy4wSg8SkxMMVbnrkD40gfZ-I6Nrz12nIIDMOwOdtDH_D4bgDA/exec";      // ←差し替え（/exec で終わるURL）
    const TALK_URL = "https://lin.ee/l2dPovS";

    // 年/月/日プルダウン
    const yearSel = document.getElementById("year");
    const monthSel = document.getElementById("month");
    const daySel = document.getElementById("day");
    const thisYear = new Date().getFullYear();
    for (let y=thisYear; y>=1900; y--) yearSel.add(new Option(y, y));
    for (let m=1; m<=12; m++) monthSel.add(new Option(m, m));
    for (let d=1; d<=31; d++) daySel.add(new Option(d, d));

    // LIFF初期化
    (async () => {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) { liff.login({ redirectUri: location.href }); return; }
      const profile = await liff.getProfile();
      document.getElementById("lineId").value = profile.userId;
    })();

    // 送信 ⇒ すぐリダイレクト（fetchは待たない）
    document.getElementById("form").addEventListener("submit", (e) => {
      e.preventDefault();
      const status = document.getElementById("status");
      status.textContent = "送信中です…";

      const fd = new FormData(e.target);
      const y = fd.get("year"), m = fd.get("month"), d = fd.get("day");
      if (y && m && d) fd.append("birth", `${y}-${m}-${d}`);

      // バックグラウンド送信
      fetch(GAS_URL, { method: "POST", body: fd }).catch(()=>{});

      // 体感を最速に：1.2秒でトークへ
      setTimeout(()=>{ window.location.href = TALK_URL; }, 1200);
    });
  </script>
</body>
</html>
